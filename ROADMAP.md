# OpsKit 路线图（v0.x 统一版）

本路线图用于统一根目录 Roadmap 与产品设计里程碑口径，作为版本规划、评审和实现的共同依据。

## 1. 规划原则

- 先通用能力，后模板扩展：先做 A~F 通用闭环，再做行业模板
- 单机自洽优先：模板与运行逻辑默认在单台服务器内完成，不隐式依赖其他节点
- 离线可落地优先：不依赖公网服务、在线仓库和外部控制面
- 证据先行：所有阶段结果可追溯到 state/report/bundle
- 设计约束优先：实现必须遵循 `docs/product-design/`，冲突需先评审再变更

## 2. 当前里程碑状态

- `M0` 已完成：框架骨架、目录结构、基础命令、state 模型
- `M1` 已完成：A/D 可执行，UI 基于 JSON 展示，状态可刷新
- `M2` 已完成：`executil` 统一执行、全局锁（冲突退出码 `4`）、基础脱敏
- `M3` 已完成：`accept/handover` 证据闭环，通用模板可验收
- `M4` 进行中：模板体系增强（黑箱接管 + 自部署双轨）
- `M5` 规划中：Recover/Operate 深化与策略化
- `M6` 规划中：交付治理与生态扩展

## 3. Milestone 定义与验收

### M0 框架与工程骨架

- 目标：搭建可扩展执行框架与统一状态模型
- 关键交付：A~F 执行骨架、插件注册机制、4 个 state JSON
- 验收门禁：命令可运行；state 文件可原子落盘

### M1 通用巡检与可视化

- 目标：实现“可看、可跑、可追踪”
- 关键交付：A/D 阶段、状态页面、`status` 刷新链路
- 验收门禁：UI 只读 JSON；阶段报告可追溯到 `artifacts.json`

### M2 执行与安全边界

- 目标：统一外部执行入口与并发控制
- 关键交付：`executil`、全局锁、脱敏规则基线
- 验收门禁：插件不得直调 `exec.Command`；锁冲突返回退出码 `4`

### M3 可验收交付

- 目标：形成通用“验收包 + 移交流程”
- 关键交付：`accept` 证据包（manifest/hashes/reports/snapshots）、`handover` 汇总
- 验收门禁：证据可复核、可脱敏、可归档；状态与产物一致

### M4 模板能力增强（当前重点）

- 目标：建立可复用模板体系，支持不同服务器用途快速接入
- 关键交付（双轨）：`blackbox-manage`（金蝶/FCS/WO 等黑箱系统接管运维）与 `deploy-manage`（MinIO/ELK/PowerJob 等自部署系统）
- 关键交付（门禁）：模板变量、检查、证据、边界约束可校验
- 验收门禁：模板通过 `template validate` 与 Review Gate
- 验收门禁：检查项只读，不产生持久状态变更
- 验收门禁：模板在单机范围自洽，可输出标准 state/report/bundle

### M5 Recover 与 Operate 深化

- 目标：提升异常场景稳定性与可诊断性
- 关键交付：readiness 扩展、重试/熔断策略、失败采集规范
- 验收门禁：Recover 行为可预测；失败场景有完整证据链

### M6 交付与生态扩展

- 目标：提升规模化交付能力
- 关键交付：模板版本治理、发布标准化、实例隔离/多实例预研
- 验收门禁：发布工件可校验、模板可版本化演进、文档与实现一致

## 4. M4 双轨模板路线（当前执行）

- 轨道 A：黑箱接管模板（Manage-only）
- 场景：已有系统不可重装，仅需纳管巡检/恢复/证据
- 核心：service unit、端口/HTTP/日志检查、恢复顺序、证据采集
- 轨道 B：自部署模板（Deploy + Manage）
- 场景：可控中间件部署与长期运维
- 核心：离线包部署、配置渲染、systemd 启停、运行验收

## 5. 版本推进策略（Preview）

- 每个 preview 建议收敛 5 个功能点
- 2 个核心能力点（执行/安全/状态一致性）
- 2 个模板能力点（黑箱或自部署模板）
- 1 个文档与门禁点（规范、测试、发布说明）

## 6. 执行约束（全里程碑生效）

- 所有功能实现必须遵循 `docs/product-design/`
- 如实现与设计约束冲突，必须先与产品负责人确认
- 未通过当前里程碑门禁，不进入下一里程碑开发
