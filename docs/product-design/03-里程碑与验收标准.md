# 03 里程碑与验收标准（统一版）

本章定义 OpsKit 的阶段推进规则、里程碑门禁和验收口径。实现与发布评审应以本章为准。

## 3.1 推进总则

- 先通用后模板：先完成 M0~M3 通用闭环，再推进模板增强
- 门禁优先：未通过当前里程碑门禁，不进入下一里程碑
- 设计约束优先：实现必须遵循 `docs/product-design/` 全部规范章节
- 冲突先确认：实现与设计冲突时，必须先与产品负责人确认

## 3.2 全局硬约束（所有里程碑生效）

- 模板与执行默认在单机范围内自洽，不隐式依赖其他节点状态
- Check 必须只读，不得产生持久性状态变更
- 插件不得直接写 state/report，统一由引擎落盘
- 插件不得直接 `exec.Command`，统一走 `executil`
- state 写入必须原子化；并发冲突必须返回退出码 `4`
- UI 必须只读 JSON，不做业务判定

## 3.3 里程碑定义与验收

### Milestone 0：框架与工程骨架

验收点：

- A~F 生命周期框架可运行
- 目录结构与插件注册机制可扩展
- 可构造并落盘核心状态文件（`overall/lifecycle/services/artifacts`）

### Milestone 1：通用巡检与可视化

验收点：

- A/D 阶段可运行并输出报告
- 页面可见 A~F 卡片与全局状态
- `status` 刷新后 JSON 与页面变化一致

### Milestone 2：执行与安全边界

验收点：

- 外部命令统一通过 `executil`
- 全局锁有效，冲突返回退出码 `4`
- 脱敏链路可用，敏感信息不明文落盘

### Milestone 3：可验收交付

验收点：

- `accept` 产出可复核证据包（manifest/hashes/reports/snapshots）
- `handover` 汇总 A~F 结果与产物索引
- 页面可展示并访问最新报告与 bundle

### Milestone 4：模板能力增强（当前）

验收点：

- 建立双轨模板能力：`blackbox-manage`（黑箱系统接管巡检/恢复/证据）与 `deploy-manage`（自部署系统部署+运维+验收）
- 模板通过契约校验与 Review Gate（见第 09 章）
- 模板可通过变量文件适配场景，不改模板主结构

### Milestone 5：Recover/Operate 深化

验收点：

- Recover 含 readiness、重试、熔断、失败采集策略
- Operate 检查项可扩展且可分级
- 恢复行为可预测，异常有可追溯证据

### Milestone 6：交付与生态扩展

验收点：

- 模板版本治理与发布流程标准化
- 多实例隔离方案具备可行性验证
- 发布工件、文档、实现三者一致

## 3.4 M4 双轨模板范围说明

### 轨道 A：`blackbox-manage`

- 面向不可重装或不可控安装过程的系统（如金蝶/FCS/WO）
- 关注接管巡检、恢复策略和证据交付
- 非目标：替代厂商安装器或重写业务部署流程

### 轨道 B：`deploy-manage`

- 面向可控自部署系统（如 MinIO/ELK/PowerJob）
- 关注离线部署、运行治理和可验收交付
- 非目标：多节点集群编排与分布式调度（当前阶段）

## 3.5 里程碑进入条件

- 进入 M4 前：M0~M3 门禁全部通过
- 进入 M5 前：M4 双轨模板至少各完成 1 个可运行模板
- 进入 M6 前：M5 Recover/Operate 深化能力完成并通过回归

## 3.6 版本节奏建议（Preview）

- 每个 preview 建议 5 个功能点
- 2 个核心能力点（执行/安全/状态一致性）
- 2 个模板能力点（黑箱或自部署）
- 1 个文档与门禁点（规范/测试/发布说明）
