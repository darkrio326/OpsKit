# 05 模板与插件体系

## 5.1 模板目标与边界

模板只描述三件事：

- 关键对象：组件与依赖
- 判定规则：健康检查
- 动作策略：部署/恢复/证据

硬性边界：

- 模板不能改写通用阶段规则（A/B/D/E/F）
- 模板需适配离线环境
- Manage 模板优先用于“接管”，Deploy 模板用于“可部署”

## 5.2 模板核心模型

- Stack：用途（如 elk/oa/minio）
- Component：单元（systemd/compose/process）
- Check：判活规则（unit/port/http/command/log）
- Action：动作（deploy/recover/collect 等）
- Evidence：验收采集（hash/snapshot/command）
- Dependencies：顺序与等待条件

## 5.3 模式定义

### Manage 模式

- 不负责安装软件
- 负责接管巡检、恢复、证据

### Deploy 模式

- 负责离线包部署到可运行状态
- 包含 systemd 注册、启动验证、交付证据

## 5.4 插件接口统一约束

- check/action/evidence 统一返回标准结果结构
- 插件只做“参数解析 + 执行 + 结果”
- 禁止插件直接写 state/report（由引擎统一处理）
- 禁止插件直接 `exec.Command`，统一走 `executil`

## 5.5 v1 最小能力集合

- checks：system_info、mount_check、port_conflict、systemd_*、disk/memory/load 等
- actions：ensure_paths、untar、sha256_verify、render_templates、systemd_*、capture_inventory
- evidence：command_output、file_hash、dir_hash、process_args
