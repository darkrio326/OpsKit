一、总体验收原则（贯穿所有阶段）

所有阶段 必须同时满足这 5 条，才算“完成”：
	1.	可重复：同一阶段可多次执行，不破坏系统
	2.	可观察：页面能看到状态 + 核心指标
	3.	可证据化：有 JSON 状态 + 人类可读报告
	4.	可回溯：至少保留最近 N 次记录
	5.	可解释：失败有原因，有建议动作

⚠️ 没页面、没 JSON、没报告 → 一律不算完成

⸻

二、里程碑级验收标准（决定你“能不能进入下一阶段”）

✅ Milestone 1：通用服务器接管完成

验收通过的定义：
	•	一条命令可完成 OpsKit 安装
	•	页面可访问（本机/局域网）
	•	页面显示 A~F 六个阶段卡片（哪怕部分为 NOT_STARTED）
	•	Preflight + Operate 至少各生成 1 份报告
	•	所有状态来自 JSON，而非前端计算

👉 没这一步，不允许做 Recover / Accept

⸻

✅ Milestone 2：异常与断电恢复闭环完成

验收通过的定义：
	•	系统重启后，Recover 能自动触发
	•	能判断“是否需要恢复”，不会无脑重启
	•	关键服务未运行时，能按顺序尝试拉起
	•	失败不会无限循环，有熔断
	•	每次恢复都有报告 + 时间线

👉 没这一步，不允许对外说“高可用 / 自愈”

⸻

✅ Milestone 3：验收与交付能力完成

验收通过的定义：
	•	一条命令生成验收证据包
	•	证据包包含 hash、路径、生效状态
	•	页面可直接下载最近一次验收包
	•	能生成交付汇总报告（A~F 摘要）

👉 没这一步，OpsKit 不能称为“交付工具”

⸻

三、阶段级检查项清单（核心设计部分）

下面是通用服务器版本的最小清单（模板只是在此基础上加项）。

⸻

阶段 A：Preflight（接管检查）

A-1 基础事实（必须全部有）
	•	OS 名称 / 版本
	•	内核版本
	•	CPU 架构（x86_64 / aarch64）
	•	主机名
	•	时区
	•	当前时间同步状态（是否明显漂移）

A-2 磁盘与挂载
	•	所有磁盘列表
	•	关键挂载点存在性（/ /data /opt /logs）
	•	每个挂载点：容量 / 使用率 / inode 使用率

A-3 网络与端口
	•	默认路由存在
	•	DNS 配置存在
	•	当前监听端口列表
	•	与“保留端口清单”的冲突检测

A-4 安全与系统状态
	•	防火墙状态（启用/关闭/未知）
	•	SELinux 状态（启用/关闭/未知）
	•	systemd 是否可用

A-5 风险评估输出（不是修复）
	•	风险等级（INFO/WARN/FAIL）
	•	每条风险有“原因 + 建议动作”
	•	页面能看到风险数量汇总

完成标准
	•	页面 Preflight 卡片 ≠ NOT_STARTED
	•	至少 1 份 preflight 报告存在

⸻

阶段 B：Baseline（基线标准化）

B-1 运维目录结构
	•	OpsKit 工作目录存在
	•	标准部署目录存在（可配置）
	•	日志目录存在

B-2 权限与用户（最小集）
	•	OpsKit 有自身读写权限
	•	可识别运维执行用户
	•	sudo 能力检测（只检测，不强改）

B-3 基线状态固化
	•	目录结构 hash
	•	权限快照摘要
	•	作为后续阶段对比基准

完成标准
	•	Baseline 报告生成
	•	页面显示 Baseline = Applied

⸻

阶段 C：Deploy（用途声明与部署）

C-0 用途声明（没有用途，不允许进入后续）
	•	服务器用途列表（stack profiles）
	•	每个用途的关键服务名
	•	每个用途的关键端口

C-1 通用部署能力（不关心内部细节）
	•	能执行离线包部署（不强制）
	•	能注册 systemd / compose
	•	能识别部署结果

C-2 版本与状态证据
	•	部署包 hash
	•	配置文件 hash（脱敏）
	•	启动参数摘要

完成标准
	•	页面显示 Deploy 已完成
	•	至少一个 stack 有 Deploy 报告

⸻

阶段 D：Operate（运行巡检）

D-1 服务状态
	•	systemd unit active/inactive
	•	服务 PID 存在性

D-2 健康检查
	•	端口监听状态
	•	HTTP 检查（如适用）
	•	日志关键字（可选）

D-3 资源阈值
	•	磁盘使用率
	•	内存可用量
	•	系统负载（简单）

D-4 巡检节奏
	•	可手动触发
	•	可定时触发
	•	保留历史记录

完成标准
	•	页面显示 Overall Status
	•	Operate 状态能变化（绿/黄/红）

⸻

阶段 E：Recover（异常与断电恢复）

E-1 触发条件
	•	系统启动后可触发
	•	定时巡检异常可触发

E-2 恢复逻辑
	•	环境就绪判定（网络/挂载）
	•	按用途/依赖顺序启动
	•	每个服务有限重试

E-3 熔断与兜底
	•	失败不无限重试
	•	失败生成 collect 证据包

完成标准
	•	重启服务器后 Recover 有记录
	•	页面能看到最近一次恢复结果

⸻

阶段 F：Accept / Handover（验收与交付）

F-1 证据采集
	•	前端构建产物 hash
	•	后端包 hash
	•	配置文件 hash
	•	当前运行态摘要

F-2 验收包生成
	•	固定结构
	•	hash 清单
	•	JSON + HTML 报告

F-3 交付汇总
	•	汇总 A~F 关键状态
	•	可长期归档

完成标准
	•	页面可下载验收包
	•	交付报告可单独保存

⸻

四、模板扩展的验收规则（为后面铺路）

当你引入 ELK / OA / MinIO 模板时：
	•	❌ 不允许改动 A/B/D/E/F 的通用规则
	•	✅ 只能：
	•	增加检查项
	•	增加健康规则
	•	增加证据内容

模板的验收标准 =
通用阶段验收通过 + 模板专属检查项通过

未完成 Milestone 1~3，不允许新增模板与高级功能。